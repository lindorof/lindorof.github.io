(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{483:function(e,a,t){"use strict";t.r(a);var s=t(27),r=Object(s.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"qt-for-macos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#qt-for-macos"}},[e._v("#")]),e._v(" Qt for macOS")]),e._v(" "),t("blockquote",[t("p",[e._v("本文翻译自 Qt 官网的 "),t("a",{attrs:{href:"https://doc.qt.io/qt-5/macos.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Qt for macOS"),t("OutboundLink")],1)])]),e._v(" "),t("p",[t("code",[e._v("macOS")]),e._v(" 是苹果 Mac 系列计算机的操作系统，以前叫 "),t("code",[e._v("OS X")]),e._v(" 或 "),t("code",[e._v("Mac OS X")]),e._v(" 。它是 UNIX 平台，基于 "),t("code",[e._v("darwin kernel")]),e._v(" ，与其它 UNIX-like 平台类似。最主要的不同是，macOS 从 X11 开始，使用自己原生的 windowing system ，并可通过 Cocoa API 进行访问。")]),e._v(" "),t("p",[e._v("若要在 macOS 上下载和安装 Qt ，请遵循 "),t("a",{attrs:{href:"https://doc.qt.io/qt-5/gettingstarted.html#",target:"_blank",rel:"noopener noreferrer"}},[e._v("Getting Started with Qt"),t("OutboundLink")],1),e._v(" 的介绍。")]),e._v(" "),t("h2",{attrs:{id:"支持的版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#支持的版本"}},[e._v("#")]),e._v(" 支持的版本")]),e._v(" "),t("p",[e._v("在讨论 Qt 对 macOS 的版本支持时，需要区分清楚构建环境和目标平台")]),e._v(" "),t("ul",[t("li",[e._v("构建环境：基于哪一个平台来构建程序")]),e._v(" "),t("li",[e._v("目标平台：所构建的程序所支持的平台")])]),e._v(" "),t("p",[e._v("下面是所支持的 macOS 版本：")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("目标平台")]),e._v(" "),t("th",[e._v("架构")]),e._v(" "),t("th",[e._v("构建环境")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("macOS 10.12, 10.13, 10.14")]),e._v(" "),t("td",[e._v("x86_64, x86_64h")]),e._v(" "),t("td",[e._v("Xcode 10 (10.14 SDK), Xcode 9 (10.13 SDK)")])])])]),e._v(" "),t("p",[t("strong",[e._v("注意")]),e._v("：Xcode9 仅支持应用的开发（可选择是否使用某些新特性，例如 layer-bakcing ，dark mode 等），不再支持 Qt 自身的开发")]),e._v(" "),t("h3",{attrs:{id:"构建环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建环境"}},[e._v("#")]),e._v(" 构建环境")]),e._v(" "),t("p",[e._v("macOS 的构建环境完全取决于构建应用的 Xcode 版本。Xcode 包含两个东西，一个是工具链（编译器、链接器、及其它），一个是 macOS 平台的 SDK（头文件和 lib 库），它们决定了应用程序的构建。")]),e._v(" "),t("p",[t("strong",[e._v("注意")]),e._v("：构建环境与所运行 Xcode 的 macOS 版本是没有任何关系的，只要你的操作系统装载了某个版本的 Xcode ，构建环境就由这个版本的 Xcode 决定。")]),e._v(" "),t("p",[e._v("Xcode 可以从苹果的 "),t("a",{attrs:{href:"https://developer.apple.com/download/",target:"_blank",rel:"noopener noreferrer"}},[e._v("developer website"),t("OutboundLink")],1),e._v(" 页面下载（包括老版本的 Xcode）。安装完成之后，需要使用 "),t("code",[e._v("xcode-select")]),e._v(" 工具来指定所安装的 Xcode ：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" xcode-select --switch /Applications/Xcode.app\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("并且可以检查所指定的 Xcode ：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ xcode-select -print-path\n/Applications/Xcode.app/Contents/Developer\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v("然后，可通过 "),t("code",[e._v("xcrun")]),e._v(" 命令来查找工具链中的某个工具：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ xcrun -sdk macosx -find clang\n/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("p",[e._v("或者查看平台 SDK 的路径：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("$ xcrun -sdk macosx --show-sdk-path\n/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br")])]),t("h3",{attrs:{id:"目标平台"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目标平台"}},[e._v("#")]),e._v(" 目标平台")]),e._v(" "),t("p",[e._v("macOS 上的构建会使用一个叫做 "),t("em",[t("strong",[e._v("weak linking")])]),e._v(" 的技术，它让我们可以基于最新平台 SDK 的头文件和 lib 库进行构建，同时又让我们的应用程序可以发布到低版本 SDK 的 macOS 上。当程序在 macOS 运行时，如果该 macOS 的 SDK 版本低于构建时的 SDK 版本，则 Qt 会进行运行时检查，确定某些平台特性是否可用。")]),e._v(" "),t("p",[e._v("理论上来说，这种机制允许应用程序在所有的 macOS 版本上运行，但由于一些实际的技术上的原因，还是会有一个最低版本限制，也就是应用程序的 "),t("em",[t("strong",[e._v("deployment target (发布目标)")])]),e._v(" 。如果运行程序的 macOS 版本低于发布目标，则 macOS 或 Qt 不会让程序运行，并给出错误提示信息。")]),e._v(" "),t("p",[e._v("Qt 通过 qmake 变量 "),t("code",[e._v("QMAKE_MACOSX_DEPLOYMENT_TARGET")]),e._v(" 来设置发布目标，macOS 上的 "),t("code",[e._v("makespec")]),e._v(" 已为该变量设置了默认值。一般情况下不需要更改该默认值，但如果需要，可以在工程文件中进行配置：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("QMAKE_MACOSX_DEPLOYMENT_TARGET "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("10.13")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[t("strong",[e._v("注意")]),e._v("：在工程文件中配置的该值不能低于 Qt 的默认值，否则可能导致运行时错误。")]),e._v(" "),t("p",[e._v("综上所述，确保总是基于最新的平台 SDK 进行构建，可以让 Qt 应用程序使用到最新 macOS 版本的新特性。")]),e._v(" "),t("p",[e._v("关于 macOS SDK 开发的更多信息，参看苹果官网的 "),t("a",{attrs:{href:"https://developer.apple.com/library/mac/#documentation/DeveloperTools/Conceptual/cross_development/Introduction/Introduction.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("developer documentation"),t("OutboundLink")],1),e._v(" 。")]),e._v(" "),t("blockquote",[t("p",[t("em",[t("strong",[e._v("关于 macOS 不同版本带来的特性变化")])])])]),e._v(" "),t("p",[e._v("在使用最新版本的 Xcode 和 SDK 构建应用程序时，有一点需要额外说明：基于构建应用程序的 SDK 版本，macOS 系统框架有时候需要决定是否启用对应的新变化的特性。")]),e._v(" "),t("p",[e._v("例如，macOS 10.14 Mojave 版本引入了 dark-mode ，那么 macOS 会认为，只有基于 10.14 SDK 构建的应用程序才支持 dark-mode ，而其它基于早期 SDK 构建的应用程序会使用默认的 light-mode 。通过这个机制，苹果确保了基于早期 SDK/OS 构建的应用程序可以被发布，并且不需要回归测试就能够在新发布的 macOS 系统上运行。")]),e._v(" "),t("p",[e._v("而进一步的，如果 Qt 在处理 macOS 的一些新特性（dark-mode, layer-backed views）时遇到问题，要弃用这些新特性，则唯一的方式是：基于更早版本的 SDK（10.13 SDK, Xcode 9）来构建应用程序。但要注意，这只是最后的解决办法，在你的应用程序无法解决或无法绕开问题时才应当采用。")]),e._v(" "),t("h3",{attrs:{id:"架构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[e._v("#")]),e._v(" 架构")]),e._v(" "),t("p",[e._v("默认情况下，Qt 会编译为 x86_64 架构。如果要编译为 x86_64_h（haswell）架构，需使用 qmake 的 "),t("code",[e._v("QMAKE_APPLE_DEVICE_ARCHS")]),e._v(" 变量，在配置时进行指定：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("./configure -platform macx-clang "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("QMAKE_APPLE_DEVICE_ARCHS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("x86_64h\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("另外，"),t("code",[e._v("QMAKE_APPLE_DEVICE_ARCHS")]),e._v(" 也可以设置为用空格分隔的清单，来同时构建为多个架构：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("./configure -platform macx-clang "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("QMAKE_APPLE_DEVICE_ARCHS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"x86_64 x86_64h"')]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"其它的命令行选项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其它的命令行选项"}},[e._v("#")]),e._v(" 其它的命令行选项")]),e._v(" "),t("p",[e._v("在命令行模式下，可以使用 "),t("code",[e._v("qmake")]),e._v(" 和 "),t("code",[e._v("make")]),e._v(" 来构建应用程序，而对于 "),t("code",[e._v("qmake")]),e._v(" 来说，可以有一些额外的选项。")]),e._v(" "),t("p",[e._v("一方面，对于二进制的包，"),t("code",[e._v("qmake")]),e._v(" 默认会创建 Xcode 工程；一方面，可使用 "),t("code",[e._v("-spec macx-gcc")]),e._v(" 来创建 makefile ；一方面，可使用 "),t("code",[e._v("-spec macx-xcode")]),e._v(" 来创建 Xcode 工程；例如：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("qmake -spec macx-xcode project.pro\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("通过 "),t("code",[e._v("qmake")]),e._v(" 并指定 "),t("code",[e._v("-spec macx-xcode")]),e._v(" 来创建 Xcode 工程文件时，不用再关心 Qt 的预处理器（"),t("a",{attrs:{href:"https://doc.qt.io/qt-5/moc.html#",target:"_blank",rel:"noopener noreferrer"}},[e._v("moc"),t("OutboundLink")],1),e._v(" 和 "),t("a",{attrs:{href:"https://doc.qt.io/qt-5/uic.html#",target:"_blank",rel:"noopener noreferrer"}},[e._v("uic"),t("OutboundLink")],1),e._v("）规则，因为 "),t("a",{attrs:{href:"https://doc.qt.io/qt-5/qmake-manual.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("qmake"),t("OutboundLink")],1),e._v(" 都自动处理好了，并且确保了所需的内容都被链接进应用程序中。")]),e._v(" "),t("p",[e._v("Qt 并不会完全的与开发环境交互，例如，可以在 Xcode 的交互界面下，通过插件来设置一个文件为 "),t("code",[e._v("mocable")]),e._v(" 。")]),e._v(" "),t("p",[e._v("构建以后的结果是一个应用程序包，它是一个目录结构，包含可执行程序。因此，应用程序可以通过苹果的 Finder 来双击运行，也可以通过命令行来指向可执行程序：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("myApp.app/Contents/MacOS/myApp\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("如果你希望构建为命令行工具而不使用 GUI ，例如 "),t("code",[e._v("moc")]),e._v(" ，"),t("code",[e._v("uic")]),e._v(" ，"),t("code",[e._v("ls")]),e._v(" 等，你可以在工程文件中设置 "),t("code",[e._v("CONFIG")]),e._v(" 变量，从而让 "),t("code",[e._v("qmake")]),e._v(" 禁用程序包的创建：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("CONFIG -"),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" app_bundle\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("h2",{attrs:{id:"在-macos-上发布应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在-macos-上发布应用"}},[e._v("#")]),e._v(" 在 macOS 上发布应用")]),e._v(" "),t("p",[e._v("macOS 应用一般发布为自包含的应用程序包，在应用程序包中，包含了可执行程序及依赖项，例如 Qt 库、插件、语言包及其它可能使用到的资源。类似 Qt 的第三方库一般不会被安装在系统中，因此每个应用程序中都会包含一份对应的拷贝。")]),e._v(" "),t("p",[e._v("一般发布应用的方式是提供为 compressed disk image（.dmg文件），从而用户可以直接在 Finder 中挂载。通过 "),t("em",[t("strong",[e._v("macdeployqt")])]),e._v(" （"),t("code",[e._v("bin/macdeployqt")]),e._v("）这个发布工具，可以创建自包含的应用程序包，也可以创建 .dmg 文件。另外，应用也可以通过  Mac App Store 来发布，而 Qt 5 致力于满足和遵守 app store 的沙盒规则，因此，"),t("em",[t("strong",[e._v("macdeployqt")])]),e._v(" 可以用于 app store 的发布。")]),e._v(" "),t("p",[e._v("详细参考 "),t("a",{attrs:{href:"https://doc.qt.io/qt-5/macos-deployment.html#",target:"_blank",rel:"noopener noreferrer"}},[e._v("Qt for macOS - Deployment"),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"macos-其它议题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#macos-其它议题"}},[e._v("#")]),e._v(" macOS 其它议题")]),e._v(" "),t("p",[e._v("参考下面的链接，包含了 macOS 的相关议题，以及创建 macOS 应用的一些建议：")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://doc.qt.io/qt-5/macos-issues.html#",target:"_blank",rel:"noopener noreferrer"}},[e._v("Qt for macOS - Specific Issues"),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"下一步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下一步"}},[e._v("#")]),e._v(" 下一步")]),e._v(" "),t("p",[e._v("欢迎继续浏览 Qt 的其它内容，包括 API 概述，以及如何使用 API 的例子。")]),e._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://doc.qt.io/qt-5/overviews-main.html#",target:"_blank",rel:"noopener noreferrer"}},[e._v("Qt Overviews"),t("OutboundLink")],1),e._v(" - 应用开发相关的主题")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://doc.qt.io/qt-5/qtexamplesandtutorials.html#",target:"_blank",rel:"noopener noreferrer"}},[e._v("Examples and Tutorials"),t("OutboundLink")],1),e._v(" - 代码示例和教程")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://doc.qt.io/qt-5/reference-overview.html#",target:"_blank",rel:"noopener noreferrer"}},[e._v("Qt Reference Pages"),t("OutboundLink")],1),e._v(" - C++ 和 QML 的 API")])]),e._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"http://qt.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://qt.io"),t("OutboundLink")],1),e._v(" 是 Qt 非常活跃的社区，包含了 wiki 、论坛、以及其它的学习指南和介绍。")])])])}),[],!1,null,null,null);a.default=r.exports}}]);