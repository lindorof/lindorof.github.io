(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{449:function(s,t,a){s.exports=a.p+"assets/img/02-01.870d72de.png"},450:function(s,t,a){s.exports=a.p+"assets/img/02-02.167c56e2.png"},451:function(s,t,a){s.exports=a.p+"assets/img/02-03.e6fd1f26.png"},452:function(s,t,a){s.exports=a.p+"assets/img/02-04.a5f1a1d3.png"},453:function(s,t,a){s.exports=a.p+"assets/img/02-05.dacab58f.png"},454:function(s,t,a){s.exports=a.p+"assets/img/02-06.9d92fabc.png"},469:function(s,t,a){"use strict";a.r(t);var n=a(27),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_14-2-发布-crate"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-2-发布-crate"}},[s._v("#")]),s._v(" 14.2. 发布 Crate")]),s._v(" "),n("p",[n("em",[s._v("源码：关于「文档注释」的内容，使用源码 "),n("a",{attrs:{href:"https://gitee.com/lindorof/Rust_The_Book/tree/master/ch14-2-doc_test",target:"_blank",rel:"noopener noreferrer"}},[s._v("ch14-2-doc_test"),n("OutboundLink")],1),s._v(" ，其它内容使用源码 "),n("a",{attrs:{href:"https://gitee.com/lindorof/Rust_The_Book/tree/master/ch14-2-pub_use",target:"_blank",rel:"noopener noreferrer"}},[s._v("ch14-2-pub_use"),n("OutboundLink")],1)])]),s._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),n("p",[s._v("在开发过程中，我们经常会使用到 Crate ：")]),s._v(" "),n("ul",[n("li",[s._v("在 Project 中，会使用到来自 "),n("a",{attrs:{href:"https://crates.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("Crates.io"),n("OutboundLink")],1),s._v(" 的依赖")]),s._v(" "),n("li",[s._v("而同时，我们使用 "),n("a",{attrs:{href:"https://crates.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("Crates.io"),n("OutboundLink")],1),s._v("  来托管开源代码")]),s._v(" "),n("li",[s._v("可以将我们的 Crate 发布到  "),n("a",{attrs:{href:"https://crates.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("Crates.io"),n("OutboundLink")],1),s._v(" ，但需要遵循一些规则")])]),s._v(" "),n("p",[s._v("发布 Crate 需要注意这些规则：")]),s._v(" "),n("ol",[n("li",[s._v("良好的文档注释，注意不是代码注释")]),s._v(" "),n("li",[s._v("组织 API ，从而更容易使用和查找")])]),s._v(" "),n("h2",{attrs:{id:"文档注释"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#文档注释"}},[s._v("#")]),s._v(" 文档注释")]),s._v(" "),n("h3",{attrs:{id:"概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),n("p",[s._v("何为文档注释：")]),s._v(" "),n("ul",[n("li",[s._v("对于使用者来说，更关心如何使用我们提供的 Crate ，而不是我们的 Crate 如何实现")]),s._v(" "),n("li",[s._v("因此，在开发过程中，我们使用 "),n("code",[s._v("//")]),s._v(" 来进行代码注释；但是，在发布 Crate 时，需要使用文档注释")]),s._v(" "),n("li",[s._v("文档注释即 "),n("em",[n("strong",[s._v("documentation comment")])]),s._v(" ，对 Crate 进行说明，对应的语法也与代码注释不同")]),s._v(" "),n("li",[s._v("总结：开发者看到的是代码注释，而使用者看到的是文档注释")])]),s._v(" "),n("p",[s._v("文档注释的语法：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("文档注释使用 "),n("code",[s._v("//!")]),s._v(" 或 "),n("code",[s._v("///")]),s._v(" 开头")])]),s._v(" "),n("li",[n("p",[s._v("注释内容使用 MD 语法")])])]),s._v(" "),n("p",[s._v("文档的生成：")]),s._v(" "),n("ul",[n("li",[s._v("文档注释会被用来生成HTML文档")]),s._v(" "),n("li",[s._v("MD 语法会被转换为 HTML")]),s._v(" "),n("li",[s._v("通过 "),n("code",[s._v("cargo doc")]),s._v(" 生成文档，路径在 "),n("code",[s._v("target/doc")]),s._v(" 目录")]),s._v(" "),n("li",[s._v("通过 "),n("code",[s._v("cargo doc --open")]),s._v(" 可以生成文档后直接打开")])]),s._v(" "),n("blockquote",[n("p",[s._v("注意：生成的文档会自动包含所依赖的 Crate ，例如本章的源码就使用了 "),n("code",[s._v("rand")]),s._v(" 这个 Crate ，可以实际测试并查看所生成的文档样式")])]),s._v(" "),n("h3",{attrs:{id:""}},[n("a",{staticClass:"header-anchor",attrs:{href:"#"}},[s._v("#")]),s._v(" "),n("code",[s._v("//!")])]),s._v(" "),n("p",[s._v("用途：")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("对 Crate 或 Module 进行注释")])]),s._v(" "),n("li",[n("p",[s._v("总体描述该 Crate 或 Module 的功能")])])]),s._v(" "),n("p",[s._v("位置：")]),s._v(" "),n("ul",[n("li",[s._v("对于 Crate ，放在"),n("code",[s._v("src/lib.rs")]),s._v(" 的顶部")]),s._v(" "),n("li",[s._v("对于 Module ，放在 "),n("code",[s._v("mod")]),s._v(" 内所有 item 之前")])]),s._v(" "),n("blockquote",[n("p",[s._v("例如，针对 Crate ，在 "),n("code",[s._v("src/lib.rs")]),s._v(" 顶部：")])]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//! doc_test 是我们发布的 crate 名称")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("blockquote",[n("p",[s._v("又如，针对 Module ，注意看注释的位置：")])]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mod")]),s._v(" my_mod "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//! my_mod 是该 module 的名称")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("那么，生成的文档如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(449),alt:"02-01"}})]),s._v(" "),n("h3",{attrs:{id:"-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#-2"}},[s._v("#")]),s._v(" "),n("code",[s._v("///")])]),s._v(" "),n("p",[s._v("用途：")]),s._v(" "),n("ul",[n("li",[s._v("注释 item")]),s._v(" "),n("li",[s._v("例如，function ，method ，struct ，struct 中的 filed")]),s._v(" "),n("li",[s._v("注意，对于 Crate 和 Module 的注释，一般使用 "),n("code",[s._v("//!")]),s._v(" ，因为对 Rust 来说，"),n("code",[s._v("///")]),s._v(" 是针对 item 的注释，而 "),n("code",[s._v("//!")]),s._v(" 是针对包含一系列 item 的那个 item 进行注释，也就是 Crate 和 Module")]),s._v(" "),n("li",[s._v("或者说，"),n("code",[s._v("///")]),s._v(" 是用来注释一个 item ，而 "),n("code",[s._v("//!")]),s._v(" 是用来对所包含的 item 进行整体说明")])]),s._v(" "),n("p",[s._v("位置：")]),s._v(" "),n("ul",[n("li",[s._v("放在要注释的 item 之前")])]),s._v(" "),n("blockquote",[n("p",[s._v("例如，对 Crate 中的 "),n("code",[s._v("fn")]),s._v(" 进行注释")])]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// 生成指定范围的随机数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gene_rand")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("floor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ceiling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" i32 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("blockquote",[n("p",[s._v("同时，对 Crate 中的 struct 进行注释")])]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// struct 名称是 MyStruct")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" MyStruct "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("那么，生成的文档如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(450),alt:"02-02"}})]),s._v(" "),n("blockquote",[n("p",[s._v("然后，为 struct 的 field 添加注释")])]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" MyStruct "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// 存储数量")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" f1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// 存储描述信息")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" f2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("blockquote",[n("p",[s._v("再为该 struct 添加方法和注释")])]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("impl")]),s._v(" MyStruct "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// 将输入参数乘上3并返回")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("multi_three")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" i32 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\ti "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("则针对该 struct ，生成的文档如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(451),alt:"02-03"}})]),s._v(" "),n("h3",{attrs:{id:"使用-section"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-section"}},[s._v("#")]),s._v(" 使用 Section")]),s._v(" "),n("p",[s._v("说明：")]),s._v(" "),n("ul",[n("li",[s._v("文档注释使用的是 MD 语法")]),s._v(" "),n("li",[s._v("因此可以使用诸如 "),n("code",[s._v("#")]),s._v(" 这样的 MD 标题，也就是 Section")]),s._v(" "),n("li",[s._v("使用 Section 的作用是，让生成的文档内容分门别类，表达和阅读得更清晰")])]),s._v(" "),n("p",[s._v("常用的 Section ：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("Examples")]),s._v(" ：例子代码，这个涉及到 Doc-tests ，后续再讲")]),s._v(" "),n("li",[n("strong",[s._v("Panics")]),s._v(" ：说明在哪些情况下可能导致程序 panic")]),s._v(" "),n("li",[n("strong",[s._v("Errors")]),s._v(" ：如果函数返回值是 "),n("code",[s._v("Result")]),s._v(" ，则说明有哪些类型的错误，以及在哪些情况下会返回错误")]),s._v(" "),n("li",[n("strong",[s._v("Safety")]),s._v(" ：如果函数属于 "),n("code",[s._v("unsafe")]),s._v(" （在 Chapter19 讲解），则进行说明")])]),s._v(" "),n("p",[s._v("注意：")]),s._v(" "),n("ul",[n("li",[s._v("Section 仅仅只是 MD 的语法之一，其作用也仅仅只是影响到生成的 HTML 格式")]),s._v(" "),n("li",[s._v("而上述列举的 Section ，是 Rust 开发者约定俗成的")])]),s._v(" "),n("blockquote",[n("p",[s._v("例如，可以使用上述 Section ，也可以使用其它 Section")])]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// 生成指定范围的随机数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// # Panics")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// 说明在哪些情况下会导致panic")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// # 备注")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// 为了HTML文档的格式，可以自己增加 Section")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gene_rand")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("floor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ceiling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" i32 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("那么生成的文档如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(452),alt:"02-04"}})]),s._v(" "),n("h3",{attrs:{id:"doc-tests"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#doc-tests"}},[s._v("#")]),s._v(" Doc-tests")]),s._v(" "),n("p",[s._v("什么是 "),n("code",[s._v("Doc-tests")]),s._v(" ：")]),s._v(" "),n("ul",[n("li",[s._v("在运行 "),n("code",[s._v("cargo test")]),s._v(" 时，可以看到 "),n("code",[s._v("Doc-tests")])]),s._v(" "),n("li",[s._v("也就是在进行文档注释时，编写的使用示例")]),s._v(" "),n("li",[s._v("因此，这些使用示例是文档注释的一部分，但可以在 "),n("code",[s._v("cargo test")]),s._v(" 时被识别为测试的一部分，即 "),n("code",[s._v("Doc-tests")])]),s._v(" "),n("li",[s._v("无论是 "),n("code",[s._v("///")]),s._v(" 或 "),n("code",[s._v("//!")]),s._v(" ，都可以编写使用示例")]),s._v(" "),n("li",[s._v("语法与 MD 一致，在代码的开头和结尾分别使用 ``` 进行标注")]),s._v(" "),n("li",[s._v("而对于示例程序，一般作为独立的 Section ，且 Section 名称使用 "),n("code",[s._v("# Examples")])])]),s._v(" "),n("p",[s._v("例如：")]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// 生成指定范围的随机数")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// # Panics")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// 说明在哪些情况下会导致panic")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// # 备注")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// 为了HTML文档的格式，可以自己增加 Section")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// # Examples")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ```")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// let i = doc_test::gene_rand(1, 101);")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ```")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gene_rand")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("floor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ceiling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" i32 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\trand"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("thread_rng")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gen_range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("floor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ceiling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("又如：")]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mod")]),s._v(" my_mod "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//! my_mod 是该 module 的名称")]),s._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// 将输入参数加1并返回")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// # Examples")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ```")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// let i = doc_test::my_mod::add_one(5);")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// assert_eq!(6, i);")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// ```")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("///")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add_one")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" i32"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" i32 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\ti "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("需要注意的是：")]),s._v(" "),n("ul",[n("li",[s._v("对于 "),n("code",[s._v("Doc-tests")]),s._v(" ，需要访问的 item 都需要从 Crate 前缀开始")]),s._v(" "),n("li",[s._v("例如上面的例子，Crate 名称是 "),n("code",[s._v("doc_test")]),s._v(" ，访问 "),n("code",[s._v("add_one")]),s._v(" 时，需要写为 "),n("code",[s._v("doc_test::my_mod::add_one")])])]),s._v(" "),n("p",[s._v("使用 "),n("code",[s._v("cargo test")]),s._v(" 运行本章的源码，可以看到关于 "),n("code",[s._v("Doc-tests")]),s._v(" 的输出：")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cargo test\n\n   Doc-tests doc_test\n\nrunning 4 tests\ntest src/lib.rs - gene_rand (line 70) ... ok\ntest src/lib.rs - MyStruct::multi_three (line 32) ... ok\ntest src/lib.rs -  (line 5) ... ok\ntest src/lib.rs - my_mod::add_one (line 49) ... ok\n\ntest result: ok. 4 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h2",{attrs:{id:"组织-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#组织-api"}},[s._v("#")]),s._v(" 组织 API")]),s._v(" "),n("h3",{attrs:{id:"概述-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#概述-2"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),n("p",[s._v("关于 "),n("em",[n("strong",[s._v("internal structure")])]),s._v(" 和 "),n("em",[n("strong",[s._v("public API")])]),s._v(" ：")]),s._v(" "),n("ul",[n("li",[s._v("在开发程序时，我们需要组织代码结构，包括使用 Struct 、Module 、Enum 等，这样可以让代码组织清晰，甚至形成很深的层次结构，这叫 "),n("em",[n("strong",[s._v("internal structure")])])]),s._v(" "),n("li",[s._v("但是在使用时，用户并不关心程序是如何实现的，而是关心如何来使用程序；也就是说，用户只关心有哪些 API 可用，以及如何找到这些 API ，这叫 "),n("em",[n("strong",[s._v("public API")])])])]),s._v(" "),n("p",[n("em",[n("strong",[s._v("internal structure")])]),s._v(" 和 "),n("em",[n("strong",[s._v("public API")])]),s._v(" 的矛盾：")]),s._v(" "),n("ul",[n("li",[s._v("代码的层次结构可以让代码组织清晰，即使是很深的层次结构")]),s._v(" "),n("li",[s._v("但是对使用者来说，如果层次过深，则需要 "),n("code",[s._v("use")]),s._v(" 的路径可能很长，例如 "),n("code",[s._v("use my_crate::some_module::another_module::UsefulType;")]),s._v(" ，而不是简洁的 "),n("code",[s._v("use my_crate::UsefulType;")])]),s._v(" "),n("li",[s._v("使用者并不熟悉我们的代码组织结构，因此对于过深的组织层次，会导致用户很难找到所需的某个 API 或 item")]),s._v(" "),n("li",[s._v("另外，代码组织的层次结构仅仅对开发有意义，而对于用户来说是没有意义的，因为用户需要的是有哪些 API 可用，以及如何方便的找到并使用这些 API")])]),s._v(" "),n("h3",{attrs:{id:"问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),n("p",[s._v("下面先看一个实际的例子，该例子是从 「The Book」中直接摘抄的，因为很简单，所以没有写注释：")]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mod")]),s._v(" kinds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("enum")]),s._v(" PrimaryColor "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tRed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\tYellow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\tBlue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("enum")]),s._v(" SecondaryColor "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tOrange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\tGreen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\tPurple"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mod")]),s._v(" utils "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("crate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("kinds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mix")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PrimaryColor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PrimaryColor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("->")]),s._v(" SecondaryColor "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tSecondaryColor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("Green\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("p",[s._v("则对应的文档如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(453),alt:"02-05"}})]),s._v(" "),n("p",[s._v("可以看到几个问题：")]),s._v(" "),n("ol",[n("li",[s._v("只能看到最外层的两个 Module")]),s._v(" "),n("li",[s._v("必须点击对应的 Module ，才能逐层的找到内部的 item ，包括 "),n("code",[s._v("mix")]),s._v(" 函数，还有 "),n("code",[s._v("PrimaryColor")]),s._v(" 、"),n("code",[s._v("SecondaryColor")]),s._v(" 等")]),s._v(" "),n("li",[s._v("而对于使用者来说，一旦组织结构太深时，很难看到、也很难找到那些可用的 item")]),s._v(" "),n("li",[s._v("在使用其中某个 API 时，可能该 API 又涉及到其它依赖，例如要使用 "),n("code",[s._v("mix")]),s._v(" 函数，其实还存在对 "),n("code",[s._v("kinds")]),s._v(" 这个 Module 中的依赖，但使用者很难在文档中查找到这些依赖")])]),s._v(" "),n("blockquote",[n("p",[s._v("比如，对于使用者来说，需要将涉及到 item 都进行 "),n("code",[s._v("use")]),s._v(" ，该例子涉及到的 item 还不算多，路径也还不算深，依赖关系也还不够复杂：")])]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" pub_use"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("kinds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("PrimaryColor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" pub_use"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("mix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" red "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PrimaryColor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("Red"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" yellow "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PrimaryColor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("Yellow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mix")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("red"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" yellow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("该例子代码的组织结构和依赖关系如下：")]),s._v(" "),n("div",{staticClass:"language-mermaid line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("graph TB\n\nsubgraph crate pub_use\n\n    subgraph mod kinds\n        PC(enum PrimaryColor)\n        SC(enum SecondaryColor)\n    end\n\n    subgraph mod utils\n        MIX[fn mix]\n    end\n\n    PC -.-> MIX\n    SC -.-> MIX\n\nend\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"pub-use"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pub-use"}},[s._v("#")]),s._v(" "),n("code",[s._v("pub use")])]),s._v(" "),n("p",[s._v("要解决上述问题，可以使用 "),n("em",[n("strong",[s._v("re-export")])]),s._v(" 机制：")]),s._v(" "),n("ul",[n("li",[s._v("将使用者关心的 item 重新进行组织，统一移动到一个地方，让用户可以方便的看到，而不用跟随代码组织的层次结构去查找")]),s._v(" "),n("li",[s._v("但注意，这并不是重新组织代码，因为代码仍然位置原来的组织结构")]),s._v(" "),n("li",[s._v("也就是说，只是针对开发时的代码组织模式，重新构建一个更适合使用者的视图")]),s._v(" "),n("li",[s._v("所以，开发时我们构建的是 "),n("em",[n("strong",[s._v("internal structure")])]),s._v(" ，而使用者看到的是 "),n("em",[n("strong",[s._v("public API")])])]),s._v(" "),n("li",[s._v("因此，"),n("em",[n("strong",[s._v("internal structure")])]),s._v(" 是关于开发时的代码组织，"),n("em",[n("strong",[s._v("public API")])]),s._v(" 是关于使用时的功能展示")]),s._v(" "),n("li",[s._v("或者打个不太恰当的比方，"),n("em",[n("strong",[s._v("internal structure")])]),s._v(" 是数据，"),n("em",[n("strong",[s._v("public API")])]),s._v(" 是视图")]),s._v(" "),n("li",[s._v("但要注意："),n("em",[n("strong",[s._v("re-export")])]),s._v(" 只是一种 art ，而不是 science ，因为目的是为了使用者的方便")])]),s._v(" "),n("p",[s._v("具体用法：")]),s._v(" "),n("ul",[n("li",[s._v("使用 "),n("code",[s._v("pub use")]),s._v(" ，将使用者关注的那些 "),n("em",[n("strong",[s._v("public API")])]),s._v(" 放到代码组织结构的最顶层")]),s._v(" "),n("li",[s._v("最顶层其实也就是 "),n("code",[s._v("src/lib.rs")]),s._v(" 的起始位置")]),s._v(" "),n("li",[s._v("这样在生成的文档最顶层，用户就可以看到那些 "),n("em",[n("strong",[s._v("public API")])]),s._v(" ，不需要逐层查找")])]),s._v(" "),n("p",[s._v("例如，对上面的例子，使用 "),n("em",[n("strong",[s._v("re-export")])]),s._v(" 机制，注意路径可以使用 "),n("code",[s._v("self::")]),s._v(" 前缀：")]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("kinds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("PrimaryColor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("kinds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("SecondaryColor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("self")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("mix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mod")]),s._v(" kinds "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// --snip--")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pub")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("mod")]),s._v(" utils "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// --snip--")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("则生成的文档如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(454),alt:"02-06"}})]),s._v(" "),n("p",[s._v("而对于使用来说，"),n("code",[s._v("use")]),s._v(" 可以变得更简化，不需要逐层路径了：")]),s._v(" "),n("div",{staticClass:"language-rust line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-rust"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" pub_use"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("PrimaryColor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" pub_use"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("::")]),s._v("mix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fn")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// --snip--")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"开始发布"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开始发布"}},[s._v("#")]),s._v(" 开始发布")]),s._v(" "),n("h3",{attrs:{id:"建立账号"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#建立账号"}},[s._v("#")]),s._v(" 建立账号")]),s._v(" "),n("ul",[n("li",[s._v("在 "),n("a",{attrs:{href:"https://crates.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("crates.io"),n("OutboundLink")],1),s._v(" 上注册账号，最常用的是使用 GitHub 的账号")]),s._v(" "),n("li",[s._v("注册成功后，可以得到对应的 API key ，例如 "),n("code",[s._v("xxx")])]),s._v(" "),n("li",[s._v("然后可以使用该 API key 在 Cargo 命令行中登录")]),s._v(" "),n("li",[s._v("登录之后，该 API key 会被存储，存储路径是 "),n("code",[s._v("~/.cargo/credentials")])])]),s._v(" "),n("p",[s._v("登录方式如下：")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cargo login xxx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"添加-metadata"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加-metadata"}},[s._v("#")]),s._v(" 添加 Metadata")]),s._v(" "),n("p",[s._v("需要为要发布的 Crate 添加 Metadata ：")]),s._v(" "),n("ul",[n("li",[s._v("Metadata 添加在 "),n("code",[s._v("Cargo.toml")]),s._v(" 中，Section 是 "),n("code",[s._v("[package]")])]),s._v(" "),n("li",[s._v("一般常用的 Metadata 有：name/version/authors/edition/description/license ，其它的参见 "),n("a",{attrs:{href:"https://doc.rust-lang.org/cargo/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Cargo’s documentation"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("下面是一个配置例子：")]),s._v(" "),n("div",{staticClass:"language-toml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-toml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("package")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key property"}},[s._v("name")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pub_use"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key property"}},[s._v("version")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.1.0"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key property"}},[s._v("authors")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Your Name <you@example.com>"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key property"}},[s._v("edition")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2018"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key property"}},[s._v("description")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"some description"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key property"}},[s._v("license")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MIT OR Apache-2.0"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("关于 "),n("code",[s._v("name")]),s._v(" ：")]),s._v(" "),n("ul",[n("li",[s._v("标识所发布的 Crate 的名称，该名称与具体的 Project 名称无关")]),s._v(" "),n("li",[s._v("采用 "),n("em",[n("strong",[s._v("先到先服务")])]),s._v(" 的原则，名字是唯一的")]),s._v(" "),n("li",[s._v("因此发布之前，可以先在 "),n("a",{attrs:{href:"https://crates.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("crates.io"),n("OutboundLink")],1),s._v(" 网站上进行查找，若名称已被使用则进行更换，从而确保 "),n("code",[s._v("name")]),s._v(" 是唯一的")])]),s._v(" "),n("p",[s._v("关于 "),n("code",[s._v("license")]),s._v(" ：")]),s._v(" "),n("ul",[n("li",[s._v("在 "),n("a",{attrs:{href:"https://spdx.org/licenses/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Linux Foundation’s Software Package Data Exchange (SPDX)"),n("OutboundLink")],1),s._v(" 网站上列出了常见的 license")]),s._v(" "),n("li",[s._v("如果不在 SPDX 列举的范围内，则可以自己创建 license 文本，并将文件放在 Project 根目录中，然后通过 "),n("code",[s._v("license-file")]),s._v(" 来设置文件的名字")]),s._v(" "),n("li",[s._v("对于 "),n("code",[s._v("license")]),s._v(" ，支持 "),n("code",[s._v("OR")]),s._v(" ，例如 "),n("code",[s._v("MIT OR Apache-2.0")]),s._v(" ，表示使用多个 license")]),s._v(" "),n("li",[s._v("一般使用与 Rust 一致的配置，即 "),n("code",[s._v("MIT OR Apache-2.0")])])]),s._v(" "),n("h3",{attrs:{id:"发布版本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#发布版本"}},[s._v("#")]),s._v(" 发布版本")]),s._v(" "),n("p",[s._v("准备好上述事宜之后，可以发布 Crate ，但需要注意：")]),s._v(" "),n("ul",[n("li",[s._v("Crate 的发布是永久的，也就是说，发布以后的版本永远不会被覆盖，代码永远不会被删除")]),s._v(" "),n("li",[s._v("因为 "),n("a",{attrs:{href:"https://crates.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("crates.io"),n("OutboundLink")],1),s._v(" 的一个主要目标是，所有依赖于 "),n("a",{attrs:{href:"https://crates.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("crates.io"),n("OutboundLink")],1),s._v(" 的代码，确保永远都能工作及可以被编译，因此发布在 "),n("a",{attrs:{href:"https://crates.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("crates.io"),n("OutboundLink")],1),s._v(" 的代码都被视为永久的 Archive")]),s._v(" "),n("li",[s._v("不限制所发布的版本数量")])]),s._v(" "),n("p",[s._v("发布版本的方式是，直接在 Project 上运行命令：")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cargo publish\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"更新版本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新版本"}},[s._v("#")]),s._v(" 更新版本")]),s._v(" "),n("p",[s._v("在版本有更新时，需要注意：")]),s._v(" "),n("ul",[n("li",[s._v("新版本语法需要参考 "),n("a",{attrs:{href:"https://semver.org",target:"_blank",rel:"noopener noreferrer"}},[s._v("Semantic Versioning rules"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("目的是：基于本次版本改变的情况，决定应该采用怎样的版本号规则，从而使用者能够更清晰的控制依赖")]),s._v(" "),n("li",[s._v("然后，继续使用 "),n("code",[s._v("cargo publish")]),s._v(" ，即可完成新版本的上传")])]),s._v(" "),n("h3",{attrs:{id:"撤回版本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#撤回版本"}},[s._v("#")]),s._v(" 撤回版本")]),s._v(" "),n("p",[s._v("如果发现某个版本存在问题，则可以撤回：")]),s._v(" "),n("ul",[n("li",[s._v("所谓的版本撤回，并不是删除该版本，而是限制新的 Project 使用该版本")]),s._v(" "),n("li",[s._v("一方面，已有的依赖于该版本的 Project 仍然可以下载和编译")]),s._v(" "),n("li",[s._v("一方面，新的项目都不允许依赖于该版本")])]),s._v(" "),n("p",[s._v("撤回某个版本的方式：")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cargo yank --vers 1.0.1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("对应的，可以恢复撤回：")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("$ cargo yank --vers 1.0.1 --undo\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);