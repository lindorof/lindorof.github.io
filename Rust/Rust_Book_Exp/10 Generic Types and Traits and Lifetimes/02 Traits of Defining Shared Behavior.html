<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>10.2. 定义 trait | Lindorof</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="Lindorof's Blog">
    <link rel="preload" href="/assets/css/0.styles.8ac2847d.css" as="style"><link rel="preload" href="/assets/js/app.b639eb72.js" as="script"><link rel="preload" href="/assets/js/2.5df156af.js" as="script"><link rel="preload" href="/assets/js/52.c4983004.js" as="script"><link rel="prefetch" href="/assets/js/10.ee4568ff.js"><link rel="prefetch" href="/assets/js/11.8db0767a.js"><link rel="prefetch" href="/assets/js/12.92a4e660.js"><link rel="prefetch" href="/assets/js/13.e2450b62.js"><link rel="prefetch" href="/assets/js/14.5ae14743.js"><link rel="prefetch" href="/assets/js/15.62a967cf.js"><link rel="prefetch" href="/assets/js/16.3482df63.js"><link rel="prefetch" href="/assets/js/17.881a9d91.js"><link rel="prefetch" href="/assets/js/18.d6e19ee5.js"><link rel="prefetch" href="/assets/js/19.caf0829a.js"><link rel="prefetch" href="/assets/js/20.a80e123c.js"><link rel="prefetch" href="/assets/js/21.9c810086.js"><link rel="prefetch" href="/assets/js/22.bc5f69cb.js"><link rel="prefetch" href="/assets/js/23.f15ef55d.js"><link rel="prefetch" href="/assets/js/24.b8714e3e.js"><link rel="prefetch" href="/assets/js/25.d673c092.js"><link rel="prefetch" href="/assets/js/26.28d57b84.js"><link rel="prefetch" href="/assets/js/27.d8b15b76.js"><link rel="prefetch" href="/assets/js/28.2574be13.js"><link rel="prefetch" href="/assets/js/29.54667d47.js"><link rel="prefetch" href="/assets/js/3.f6602695.js"><link rel="prefetch" href="/assets/js/30.dd697263.js"><link rel="prefetch" href="/assets/js/31.aafbc8db.js"><link rel="prefetch" href="/assets/js/32.5fe2531d.js"><link rel="prefetch" href="/assets/js/33.c3dfca3c.js"><link rel="prefetch" href="/assets/js/34.22613e38.js"><link rel="prefetch" href="/assets/js/35.aad9af2b.js"><link rel="prefetch" href="/assets/js/36.badbd522.js"><link rel="prefetch" href="/assets/js/37.45905373.js"><link rel="prefetch" href="/assets/js/38.ab0de43e.js"><link rel="prefetch" href="/assets/js/39.d1a7492c.js"><link rel="prefetch" href="/assets/js/4.c7710dca.js"><link rel="prefetch" href="/assets/js/40.92c4cb14.js"><link rel="prefetch" href="/assets/js/41.cc19be50.js"><link rel="prefetch" href="/assets/js/42.c9b4b585.js"><link rel="prefetch" href="/assets/js/43.1af966c8.js"><link rel="prefetch" href="/assets/js/44.40ebac1c.js"><link rel="prefetch" href="/assets/js/45.469b8553.js"><link rel="prefetch" href="/assets/js/46.eb491d21.js"><link rel="prefetch" href="/assets/js/47.03d1fbf2.js"><link rel="prefetch" href="/assets/js/48.af296c16.js"><link rel="prefetch" href="/assets/js/49.3a42b55b.js"><link rel="prefetch" href="/assets/js/5.339eb2f5.js"><link rel="prefetch" href="/assets/js/50.ef35a161.js"><link rel="prefetch" href="/assets/js/51.284d50de.js"><link rel="prefetch" href="/assets/js/53.83c193e1.js"><link rel="prefetch" href="/assets/js/54.08f26cd6.js"><link rel="prefetch" href="/assets/js/55.ef20313b.js"><link rel="prefetch" href="/assets/js/56.dc2772cf.js"><link rel="prefetch" href="/assets/js/57.add26447.js"><link rel="prefetch" href="/assets/js/58.ff8f2704.js"><link rel="prefetch" href="/assets/js/59.43fdbc04.js"><link rel="prefetch" href="/assets/js/6.0ce72a94.js"><link rel="prefetch" href="/assets/js/60.1a27c7c3.js"><link rel="prefetch" href="/assets/js/61.9ca63ff6.js"><link rel="prefetch" href="/assets/js/62.9ab09b12.js"><link rel="prefetch" href="/assets/js/63.a6b6d595.js"><link rel="prefetch" href="/assets/js/64.5e9ac56b.js"><link rel="prefetch" href="/assets/js/65.bcfb6015.js"><link rel="prefetch" href="/assets/js/66.5024eb22.js"><link rel="prefetch" href="/assets/js/67.5d83f99f.js"><link rel="prefetch" href="/assets/js/68.80f05874.js"><link rel="prefetch" href="/assets/js/69.6f9ff293.js"><link rel="prefetch" href="/assets/js/7.726c7fbf.js"><link rel="prefetch" href="/assets/js/70.92b749fb.js"><link rel="prefetch" href="/assets/js/71.a4248217.js"><link rel="prefetch" href="/assets/js/72.29aeb940.js"><link rel="prefetch" href="/assets/js/73.8918e90b.js"><link rel="prefetch" href="/assets/js/74.81fd32da.js"><link rel="prefetch" href="/assets/js/75.5357ccc2.js"><link rel="prefetch" href="/assets/js/76.66fc1725.js"><link rel="prefetch" href="/assets/js/77.6f29512b.js"><link rel="prefetch" href="/assets/js/78.a63871cd.js"><link rel="prefetch" href="/assets/js/79.c646997c.js"><link rel="prefetch" href="/assets/js/8.81d630fc.js"><link rel="prefetch" href="/assets/js/80.b5d5ad39.js"><link rel="prefetch" href="/assets/js/81.601aa569.js"><link rel="prefetch" href="/assets/js/82.99bc0640.js"><link rel="prefetch" href="/assets/js/83.06d4defc.js"><link rel="prefetch" href="/assets/js/84.44856307.js"><link rel="prefetch" href="/assets/js/85.3b88ee80.js"><link rel="prefetch" href="/assets/js/86.47c806cb.js"><link rel="prefetch" href="/assets/js/87.b5201cdf.js"><link rel="prefetch" href="/assets/js/88.f9ce8655.js"><link rel="prefetch" href="/assets/js/89.c1f12bf1.js"><link rel="prefetch" href="/assets/js/9.b6118830.js"><link rel="prefetch" href="/assets/js/90.e0f850a2.js"><link rel="prefetch" href="/assets/js/91.8166ca11.js"><link rel="prefetch" href="/assets/js/92.6ba6ce27.js"><link rel="prefetch" href="/assets/js/93.6e09fb58.js"><link rel="prefetch" href="/assets/js/94.1b324565.js"><link rel="prefetch" href="/assets/js/95.5308659f.js"><link rel="prefetch" href="/assets/js/96.306bee11.js"><link rel="prefetch" href="/assets/js/97.6e231fca.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8ac2847d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.jpg" alt="Lindorof" class="logo"> <span class="site-name can-hide">Lindorof</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/archives.html" class="nav-link">
  文章清单
</a></div><div class="nav-item"><a href="/guide.html" class="nav-link">
  建站指南
</a></div><div class="nav-item"><a href="https://github.com/lindorof" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/archives.html" class="nav-link">
  文章清单
</a></div><div class="nav-item"><a href="/guide.html" class="nav-link">
  建站指南
</a></div><div class="nav-item"><a href="https://github.com/lindorof" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Rust/Rust_Book_Exp/" aria-current="page" class="sidebar-link">「RustBook」学习心得</a></li><li><a href="/Rust/Rust_Book_Exp/01 Getting Started/01 Getting Started.html" class="sidebar-link">1. 开始</a></li><li><a href="/Rust/Rust_Book_Exp/02 Programming a Guessing Game/01 Programming a Guessing Game.html" class="sidebar-link">2. 猜谜游戏</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>3. 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4. 所有权</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5. 结构体</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>6. 枚举</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>7. 模块</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>8. 集合</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>9. 错误处理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>10. 泛型及生命周期</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Rust/Rust_Book_Exp/10 Generic Types and Traits and Lifetimes/00 Foreword.html" class="sidebar-link">10.0. 前言</a></li><li><a href="/Rust/Rust_Book_Exp/10 Generic Types and Traits and Lifetimes/01 Generic Data Types.html" class="sidebar-link">10.1. 泛型 generic</a></li><li><a href="/Rust/Rust_Book_Exp/10 Generic Types and Traits and Lifetimes/02 Traits of Defining Shared Behavior.html" class="active sidebar-link">10.2. 定义 trait</a></li><li><a href="/Rust/Rust_Book_Exp/10 Generic Types and Traits and Lifetimes/03 Validating References with Lifetimes.html" class="sidebar-link">10.3. 标注 lifetime</a></li><li><a href="/Rust/Rust_Book_Exp/10 Generic Types and Traits and Lifetimes/04 Thinking in Lifetimes.html" class="sidebar-link">10.4. Thinking in Lifetimes</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>11. 自动测试</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>12. 命令行</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>13. 闭包及迭代器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>14. Cargo 和 Crates.io</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>15. 智能指针</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>16. 无畏并发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>17. 面向对象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>18. 模式与匹配</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>19. 高级特征</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_10-2-定义-trait"><a href="#_10-2-定义-trait" class="header-anchor">#</a> 10.2. 定义 trait</h1> <p>什么是 trait :</p> <ul><li>某种 type 的行为，就是我们能够在该 type 上调用到的方法</li> <li>如果多种 type 具备共同的行为，则可以使用 trait 来将这些共同的行为组织在一起</li></ul> <blockquote><p>trait 类似其它语言中的 interface ，虽然有些细微的差异</p></blockquote> <h3 id="defining-a-trait"><a href="#defining-a-trait" class="header-anchor">#</a> Defining a Trait</h3> <p>语法举例：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">trait</span> Summary <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> String<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>语法说明：</p> <ol><li>关键字是 <code>trait</code></li> <li>trait 有名称，在该例子中是 <code>Summary</code></li> <li>trait 中的 method 只需要声明，不需要实现</li> <li>trait 中可以有多个 method，每个 method 一行</li></ol> <h3 id="implementing-a-trait-on-a-type"><a href="#implementing-a-trait-on-a-type" class="header-anchor">#</a> Implementing a Trait on a Type</h3> <p>实现 trait 的例子：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">struct</span> NewsArticle <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> headline<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">pub</span> author<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">pub</span> content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> Summary <span class="token keyword">for</span> NewsArticle <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> String <span class="token punctuation">{</span>
        <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">&quot;{}, by {}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>headline<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>author<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>说明：</p> <ol><li>对于 <code>NewsArticle</code> 的 method，语法是 <code>impl NewsArticle</code></li> <li>但如果是为 <code>NewsArticle</code> 实现 <code>Summary</code> 这个 trait，则语法是 <code>impl Summary for NewsArticle</code></li> <li>因此，主语语法关键字 <code>for</code></li></ol> <p>调用 trait 与调用 method 没有区别：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> article <span class="token operator">=</span> NewsArticle <span class="token punctuation">{</span>
    headline<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;good new !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;dorof lin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;sth ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;new article: {}&quot;</span><span class="token punctuation">,</span> article<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>实现 trait 的限制：</p> <ol><li>实现 trait 时，type 和 trait ，必须至少有一个 local to our crate</li> <li>例如上面的例子，可以为 <code>NewsArticle</code> 实现标准库的 <code>Display</code> 这个 trait ，也可以为标准库的 <code>Vec&lt;T&gt;</code> 实现 <code>Summary</code> 这个 trait</li> <li>但是，对于上面的例子，不可以为标准库的 <code>Vec&lt;T&gt;</code> 实现标准库的 <code>Display</code> 这个 trait</li> <li>这个约束叫做 <em><strong>coherence</strong></em> ，也叫 <em><strong>orphan rule</strong></em></li> <li>该约束的作用是，确保了别人不会破坏到我们的代码，反过来，也确保了我们不会破坏到别人的代码</li></ol> <h3 id="default-implementations"><a href="#default-implementations" class="header-anchor">#</a> Default Implementations</h3> <p>说明：</p> <ul><li>trait 中的部分或全部 method 可以有默认的实现</li> <li>从而在为 type 实现 trait 时，对于有默认实现的那些 method，可以 keep，也可以 override</li> <li>但要注意的是，即使某个 type 的 trait 全部使用默认实现，也仍然需要有一个空的 <code>impl</code> 来表明该 type 实现了 该 trait</li> <li>例如：<code>impl Summary for NewsArticle {}</code></li></ul> <p>举例：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//定义trait，并增加默认实现</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> Summary <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> String <span class="token punctuation">{</span>
        String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;sth...&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//定义struct</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> NewsArticle <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> headline<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">pub</span> author<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">pub</span> content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// struct使用trait默认的实现</span>
<span class="token keyword">impl</span> Summary <span class="token keyword">for</span> NewsArticle <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">let</span> article <span class="token operator">=</span> NewsArticle <span class="token punctuation">{</span>
    headline<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;good new !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;dorof lin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;sth ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//new article: sth...</span>
<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;new article: {}&quot;</span><span class="token punctuation">,</span> article<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>拓展：</p> <ul><li>trait 中的 method 可以调用其它 method</li> <li>无论该 method 是默认的实现还是 type 中的实现</li></ul> <p>举例：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//定义trait</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> Summary <span class="token punctuation">{</span>
    <span class="token comment">//该method由type实现</span>
    <span class="token keyword">fn</span> <span class="token function">summarize_author</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> String<span class="token punctuation">;</span>
    <span class="token comment">//该method默认实现，并调用summarize_author</span>
    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> String <span class="token punctuation">{</span>
        <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">&quot;from {}...&quot;</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">summarize_author</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//定义struct</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> NewsArticle <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> headline<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">pub</span> author<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
    <span class="token keyword">pub</span> content<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// struct只需要实现trait中的summarize_author</span>
<span class="token keyword">impl</span> Summary <span class="token keyword">for</span> NewsArticle <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">summarize_author</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> String <span class="token punctuation">{</span>
        <span class="token function">format!</span><span class="token punctuation">(</span><span class="token string">&quot;@{}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>author<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> article <span class="token operator">=</span> NewsArticle <span class="token punctuation">{</span>
    headline<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;good new !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;dorof lin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;sth ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//new article: from @dorof lin...</span>
<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;new article: {}&quot;</span><span class="token punctuation">,</span> article<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="traits-as-parameters"><a href="#traits-as-parameters" class="header-anchor">#</a> Traits as Parameters</h3> <p>trait 可以用来限定参数，其中涉及多种语法，包括语法糖，分别讲解如下。</p> <h4 id="trait-bound-syntax"><a href="#trait-bound-syntax" class="header-anchor">#</a> trait bound syntax</h4> <p>语法规则：</p> <ul><li>为 generic type 使用 <code>: trait</code> 语法</li> <li>即 <code>&lt;T: trait&gt;</code></li> <li>如果有多个 generic type，对于任何需要 trait bound 的 generic type，都需要使用 <code>: trait</code> 语法限定</li></ul> <p>举例：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> notify<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Summary<span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">fn</span> notify<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Summary<span class="token operator">&gt;</span><span class="token punctuation">(</span>t1<span class="token punctuation">:</span> T<span class="token punctuation">,</span> t2<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">fn</span> notify<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Summary<span class="token punctuation">,</span> U<span class="token punctuation">:</span> Clone<span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> T<span class="token punctuation">,</span> u<span class="token punctuation">:</span> U<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="syntax-sugar-of-impl-trait"><a href="#syntax-sugar-of-impl-trait" class="header-anchor">#</a> syntax sugar of <code>impl trait</code></h4> <p>语法规则：</p> <ul><li>直接为参数使用 <code>impl trait</code> 限定</li> <li>即 <code>(para: impl trait)</code></li> <li>这是标准语法 <code>&lt;T: trait&gt;</code> 的语法糖</li></ul> <p>举例：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">notify</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token keyword">impl</span> Summary<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">fn</span> <span class="token function">notify</span><span class="token punctuation">(</span>t1<span class="token punctuation">:</span> <span class="token keyword">impl</span> Summary<span class="token punctuation">,</span> t2<span class="token punctuation">:</span> <span class="token keyword">impl</span> Summary<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">fn</span> <span class="token function">notify</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token keyword">impl</span> Summary<span class="token punctuation">,</span> u<span class="token punctuation">:</span> <span class="token keyword">impl</span> Clone<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="mutiple-trait-bounds-with-syntax"><a href="#mutiple-trait-bounds-with-syntax" class="header-anchor">#</a> mutiple trait bounds with <code>+</code> syntax</h4> <p>语法规则：</p> <ul><li>如果有多个 trait 限制，则使用 <code>+</code> 语法</li> <li>该语法对于语法糖也可使用</li></ul> <p>举例：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">notify</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token keyword">impl</span> Summary <span class="token operator">+</span> Display<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">fn</span> notify<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Summary <span class="token operator">+</span> Display<span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> T<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="clear-trait-bounds-with-where-clauses"><a href="#clear-trait-bounds-with-where-clauses" class="header-anchor">#</a> clear trait bounds with <code>where</code> clauses</h4> <p>问题：</p> <ul><li>如果有多个 generic type</li> <li>且多个 generic type 都有多个 trait bounds</li> <li>则参数清单会变得很长和不易阅读</li></ul> <p>例如：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> notify<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Display <span class="token operator">+</span> Clone<span class="token punctuation">,</span> U<span class="token punctuation">:</span> Clone <span class="token operator">+</span> Debug<span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> T<span class="token punctuation">,</span> u<span class="token punctuation">:</span> U<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span>i32 <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>改进：</p> <ul><li>使用 <code>where</code> 从句</li> <li>从而将 generic type 的 trait bounds 统一放到 <code>where</code> 从句里面</li> <li>这样的话，函数名，参数列表，返回值，trait bounds 就很清晰的被分开，从而代码更容易阅读</li></ul> <p>举例：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> notify<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> U<span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> T<span class="token punctuation">,</span> u<span class="token punctuation">:</span> U<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> i32
    <span class="token keyword">where</span> T<span class="token punctuation">:</span> Display <span class="token operator">+</span> Clone<span class="token punctuation">,</span>
          U<span class="token punctuation">:</span> Clone <span class="token operator">+</span> Debug
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="returning-types-that-implement-traits"><a href="#returning-types-that-implement-traits" class="header-anchor">#</a> Returning Types that Implement Traits</h3> <p>语法：</p> <ul><li>函数返回值可以是实现了 trait 的 generic type</li> <li>语法是 <code>impl trait</code> ，从而不需要为返回值指定具体的类型</li></ul> <p>举例：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">ret_trait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">impl</span> Summary <span class="token punctuation">{</span>
    NewsArticle <span class="token punctuation">{</span>
        headline<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;good new !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        author<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;dorof lin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        content<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;sth ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>限制：</p> <ul><li>返回值是实现 trait 的 generic type 时有一个限制，就是所返回的 type 必须是编译时能够确定的</li> <li>因此对于运行时才能确定所返回的 generic type，编译会报错</li> <li>原因其实也很简单，因为对于 generic type，编译期会在编译期进行 <em><strong>monomorphization</strong></em> ，也就是说所返回的类型在编译器就必须确定</li></ul> <p>例如下面的代码是编译不通过的：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">ret_trait</span><span class="token punctuation">(</span>switch<span class="token punctuation">:</span> bool<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">impl</span> Summary <span class="token punctuation">{</span>
    <span class="token keyword">if</span> switch <span class="token punctuation">{</span>
        NewsArticle <span class="token punctuation">{</span>
            headline<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;good new !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            author<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;dorof lin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            content<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;sth ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        Tweet <span class="token punctuation">{</span>
            headline<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;tweet new !&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            author<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;dorof lin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            content<span class="token punctuation">:</span> String<span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;tweet ...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>注意：</p> <blockquote><p>==在 Chapter17 会讨论如何通过 <code>trait object</code> 来实现返回不同的 generic type==</p></blockquote> <h3 id="fixing-the-largest-function"><a href="#fixing-the-largest-function" class="header-anchor">#</a> Fixing the <code>largest</code> Function</h3> <p>现在重新来看前面所写的 <code>largest</code> 函数，该函数是编译不过去的，先贴在下面：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> largest<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span>list<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> T <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> largest <span class="token operator">=</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token operator">&amp;</span>item <span class="token keyword">in</span> list<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> item <span class="token operator">&gt;</span> largest <span class="token punctuation">{</span>
            largest <span class="token operator">=</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    largest
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> number_list <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;largest number is {}&quot;</span><span class="token punctuation">,</span> <span class="token function">largest</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>number_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> char_list <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token char string">'y'</span><span class="token punctuation">,</span> <span class="token char string">'m'</span><span class="token punctuation">,</span> <span class="token char string">'a'</span><span class="token punctuation">,</span> <span class="token char string">'q'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;largest char is {}&quot;</span><span class="token punctuation">,</span> <span class="token function">largest</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>char_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>错误分析：</p> <blockquote><p>编译器报错，提示 <code>T</code> 需要实现 <code>PartialOrd</code> 这个 trait，因为代码中我们使用了 <code>&gt;</code> 这种比较运算符，因此代码更改如下：</p></blockquote> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> largest<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> PartialOrd<span class="token operator">&gt;</span><span class="token punctuation">(</span>list<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> T <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> largest <span class="token operator">=</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token operator">&amp;</span>item <span class="token keyword">in</span> list<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> item <span class="token operator">&gt;</span> largest <span class="token punctuation">{</span>
            largest <span class="token operator">=</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    largest
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>错误进一步分析：</p> <blockquote><p>此时仍然编译报错，因为这句代码 <code>let mut largest = list[0]</code>，错误提示 <code>cannot move out of type [T], a non-copy slice</code>，原因是对于 generic type 的 <code>&amp;[T]</code> ，rust 默认按照 <code>Move</code> 方式对待元素 <code>T</code>，即使我们 <code>main</code> 函数中实际传入的 <code>Vector</code> 都是 scalar type</p></blockquote> <h5 id="改进办法一"><a href="#改进办法一" class="header-anchor">#</a> 改进办法一</h5> <blockquote><p>为 <code>T</code> 增加 <code>Copy</code> 或 <code>Clone</code> 的 trait，但要注意的是，对于像 <code>String</code> 这种涉及到 heap data 的类型，<code>Clone</code> 可能会影响程序性能</p></blockquote> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> largest<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> PartialOrd<span class="token operator">+</span>Copy<span class="token operator">&gt;</span><span class="token punctuation">(</span>list<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> T <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> largest <span class="token operator">=</span> list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token operator">&amp;</span>item <span class="token keyword">in</span> list<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> item <span class="token operator">&gt;</span> largest <span class="token punctuation">{</span>
            largest <span class="token operator">=</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    largest
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="改进办法二"><a href="#改进办法二" class="header-anchor">#</a> 改进办法二</h5> <blockquote><p>将返回值更改为 <code>&amp;T</code>，从而不再需要为 <code>T</code> 增加 <code>Copy</code> 或 <code>Clone</code> 的 trait，注意两种改进方式的代码实现区别</p></blockquote> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> largest<span class="token operator">&lt;</span>T<span class="token punctuation">:</span> PartialOrd<span class="token operator">&gt;</span><span class="token punctuation">(</span>list<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span>T <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> largest <span class="token operator">=</span> <span class="token operator">&amp;</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> list<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> item <span class="token operator">&gt;</span> largest <span class="token punctuation">{</span>
            largest <span class="token operator">=</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    largest
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>==未解：==</p> <blockquote><p>==上述两种改进方式中的 <code>for</code> 循环，有时需要 <code>&amp;item</code> ，有时需要 <code>item</code> ，原因还未想明白。==</p></blockquote> <h3 id="using-trait-bounds-to-conditionally-implement-methods"><a href="#using-trait-bounds-to-conditionally-implement-methods" class="header-anchor">#</a> Using Trait Bounds to Conditionally Implement Methods</h3> <ul><li>该部分内容会对 method 做一个总结回顾，包括 generic type，trait 等</li> <li>同时扩展出新的内容，例如根据 trait bound 来选择性的实现 method</li> <li>下面用代码来按学习的顺序从简单到复杂进行展示</li></ul> <h5 id="回顾：不涉及-generic-type，定义-struct-并实现-method"><a href="#回顾：不涉及-generic-type，定义-struct-并实现-method" class="header-anchor">#</a> 回顾：不涉及 generic type，定义 struct 并实现 method</h5> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> Rect <span class="token punctuation">{</span>
    width<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>
    height<span class="token punctuation">:</span> u32<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> Rect <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">cal_rect</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32 <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token keyword">self</span><span class="token punctuation">.</span>height
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="回顾：为涉及-generic-type-的-struct-实现-method"><a href="#回顾：为涉及-generic-type-的-struct-实现-method" class="header-anchor">#</a> 回顾：为涉及 generic type 的 struct 实现 method</h5> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Point<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span>T <span class="token punctuation">{</span>
        <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>x
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="回顾：为涉及-generic-type-的-struct-实现针对某种具体类型的-method"><a href="#回顾：为涉及-generic-type-的-struct-实现针对某种具体类型的-method" class="header-anchor">#</a> 回顾：为涉及 generic type 的 struct 实现针对某种具体类型的 method</h5> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> Point<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> Point<span class="token operator">&lt;</span>f32<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">distance_from_origin</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> f32 <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">.</span><span class="token function">powi</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="扩展：对于涉及-generic-type-的-struct-，针对满足-trait-bound-的-generic-type-来实现-method"><a href="#扩展：对于涉及-generic-type-的-struct-，针对满足-trait-bound-的-generic-type-来实现-method" class="header-anchor">#</a> 扩展：对于涉及 generic type 的 struct ，针对满足 trait bound 的 generic type 来实现 method</h5> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> Pair<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> T<span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> T<span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> PartialOrd<span class="token operator">&gt;</span> Pair<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">cmp_display</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="回顾：为某种类型实现-trait"><a href="#回顾：为某种类型实现-trait" class="header-anchor">#</a> 回顾：为某种类型实现 trait</h5> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">trait</span> Summary <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> String<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">struct</span> Tweet <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> Summary <span class="token keyword">for</span> Tweet <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> String <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="扩展：对于任何类型，只要满足指定的-trait-bound-，则可以为其实现另一种-trait"><a href="#扩展：对于任何类型，只要满足指定的-trait-bound-，则可以为其实现另一种-trait" class="header-anchor">#</a> 扩展：对于任何类型，只要满足指定的 trait bound ，则可以为其实现另一种 trait</h5> <p>语法：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> TraitA<span class="token operator">&gt;</span> TraitB <span class="token keyword">for</span> T <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>剖析：</p> <ul><li>这种为满足 <code>trait a</code> 的 <code>generic type T</code> 实现 <code>trait b</code> 的行为叫做 <em><strong>blanket implementation</strong></em></li> <li><em><strong>blanket implementation</strong></em> 在rust的标准库中被广泛使用</li> <li>例如，对于任何类型 <code>T</code> ，只要实现了 <code>Display</code> trait ，标准库就会为其实现 <code>ToString</code> trait</li> <li>因此，对于 <code>int</code> 类型，由于支持 <code>Display</code> trait，因此可以直接调用 <code>to_string()</code> 方法来得到对应的 <code>String</code> 内容，而 <code>to_string()</code> 方法就是标准库在 <code>ToString</code> trait 中定义的</li></ul> <p>举例：</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">pub</span> <span class="token keyword">trait</span> ToString <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function">to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> String<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token punctuation">:</span> Display<span class="token operator">&gt;</span> ToString <span class="token keyword">for</span> T <span class="token punctuation">{</span>
    <span class="token comment">// --snip--</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">12/3/2019, 8:13:20 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Rust/Rust_Book_Exp/10 Generic Types and Traits and Lifetimes/01 Generic Data Types.html" class="prev">
        10.1. 泛型 generic
      </a></span> <span class="next"><a href="/Rust/Rust_Book_Exp/10 Generic Types and Traits and Lifetimes/03 Validating References with Lifetimes.html">
        10.3. 标注 lifetime
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b639eb72.js" defer></script><script src="/assets/js/2.5df156af.js" defer></script><script src="/assets/js/52.c4983004.js" defer></script>
  </body>
</html>
